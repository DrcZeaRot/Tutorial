### 平衡二叉树(AVL树,高度平衡树)

>AVL树是最先发明的自平衡二叉查找树(Self-Balancing Binary Search Tree,简称平衡二叉树)。得名于它的发明者G.M. Adelson-Velsky和E.M. Landis。

* 条件一：它必须是二叉查找树
* 条件二：每个结点的左子树和右子树的高度差至多为1

>AVL树的查找、插入和删除在平均和最坏情况下都是O（log n），增加和删除可能需要通过一次或多次树旋转来重新平衡这个树。

##### 重要概念

1. 平衡因子：将二叉树上结点的左子树高度减去右子树高度的值称为该结点的平衡因子BF(Balance Factor)。
>对于平衡二叉树，BF的取值范围为[-1,1]。如果发现某个结点的BF值不在此范围，则需要对树进行调整。

2. [最小不平衡子树](../img/AVLTreeMinNonBalanceChildTree.png)：距离插入结点最近的，且平衡因子的绝对值大于1的结点为根的子树。

##### AVL树失衡调整
插入、删除结点可能导致AVL树失衡，根据不同条件，进行不同旋转，共以下四种情况：
>实际上，删除可以看做反向的插入操作

>失衡时，通过最小不平衡子树的根结点，及其子结点的不平衡状态，提取口诀。

>两次旋转时，旋转顺序是先子结点，后根结点。

>[口诀格式：(左/右)(左/右)]()。如["左左"代表：子结点左树小，根结点左树小]()。

>实际上上述口诀没什么意义，实现AVL树时并不是通过这个模式来判断旋转模式的。

##### 旋转
>选择一个结点作为旋转的Top。
* [如果进行右旋]()：Top向下、向右移动，达到它的右子结点位置；它的左子结点上移到Top原有位置。
    >如果右旋，Top必须有一个左子结点，否则没有节点可以上移，顶替Top原来位置。
* [如果进行左旋]()：Top向下、向左移动，达到它的左子结点位置，它的右子结点上移到Top原来位置。
    >如果左旋，Top必须有一个右子结点，否则没有节点可以上移，顶替Top原来位置。

##### 关键定义

* 内侧/外侧孙结点
>子结点的子结点定义为"孙结点"。结点X跟父节点P的关系与P跟祖父节点G的关系相同，则X是外侧孙结点；关系相反则是内侧孙结点。

>结点旋转时，Top结点下降、旋转方向反向的节点上升；如果"内侧孙结点"是上升节点的子结点，则这个孙结点要断开与父节点的连接，重新连接到Top(也就是它的祖父节点)节点上(此时会连接到旋转方向的反方向)，[孙节点变成了旋转前孙节点的"叔叔"]()。


##### 旋转图解

1. [图解-左单旋转](../img/AVLTreeRotateLeftSingle.png)
    1. 插入到右树的右结点
    2. 删除左树的左结点
    3. 口诀：左左

2. [图解-右单旋转](../img/AVLTreeRotateRightSingle.png)
    1. 插入到左树的左结点
    2. 删除右树的右结点
    3. 口诀：右右

3. [图解-先左旋后右旋](../img/AVLTreeRotateLeftAndRight.png)
    1. 插入到左树的右结点
    2. 删除右树的左结点
    3. 口诀：左右

4. [图解-先右旋后左旋](../img/AVLTreeRotateRightAndLeft.png)
    1. 插入到右树的左结点
    2. 删除左树的右结点
    3. 口诀：右左

#### 参考

[数据结构图文解析之：AVL树详解及C++模板实现](https://www.cnblogs.com/QG-whz/p/5167238.html)